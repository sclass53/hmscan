function readK(e){const t=`${e}`;if(window.localStorage){const e=JSON.parse(localStorage.getItem(DBNAME));return t in e?JSON.parse(localStorage.getItem(DBNAME))[t]:-1}return alert("浏览器不支持localstorage!"),-1}function togSolution(){var e=document.getElementById("solution"),t=e.getAttribute("style");"display: none;"==t?e.setAttribute("style",""):e.setAttribute("style","display: none;")}function readC(e){const t=`${e}`;if(window.localStorage){const e=JSON.parse(localStorage.getItem(DCNAME));return t in e?JSON.parse(localStorage.getItem(DCNAME))[t]:-1}return alert("浏览器不支持localstorage!"),-1}function writeK(e){const t=`${e}`;if(window.localStorage){null==localStorage.getItem(DBNAME)&&localStorage.setItem(DBNAME,"{}");var n=JSON.parse(localStorage.getItem(DBNAME));t in n?n[t]+=1:n[t]=1,localStorage.setItem(DBNAME,JSON.stringify(n))}else alert("浏览器不支持localstorage!")}async function makeProblem(){const e=document.querySelectorAll('input[name="copt"]:checked');if(0==e.length)uic.innerText="你好像还没有选择知识点哦!",poc.innerText="",spck.innerHTML="";else{uic.innerHTML="<h6>出题中...</h6>",poc.innerHTML='<p class="placeholder-glow">\n      <span class="placeholder col-9"></span><br>\n      <span class="placeholder col-4"></span>\n      <span class="placeholder col-6"></span>\n      <span class="placeholder col-9"></span><br>\n      <span class="placeholder col-8"></span>\n    </p>';for(var t='\n        <div class="dropdown">\n            <ul class="dropdown-menu">',n=[],l=0;l<e.length;l++)t+=`<li><span class='dropdown-item'>${e[l].getAttribute("value")}</span></li>`,n.push(e[l].getAttribute("value"));t+="</ul></div>",spck.innerHTML=t;var a=new Headers;a.append("Authorization",`Bearer ${tok}`);try{var o=await fetch("https://hmscannerserver.netlify.app/.netlify/functions/makeproblem",{method:"POST",headers:a,body:`${n.join("\n")}`});o=await o.text()}catch{return poc.innerText="ERR...",MathJax.typeset(),void(uic.innerHTML="<h6>网络好像有点问题, 请刷新页面!</h6>")}var r=o.split("题解");poc.innerHTML=r[0].replaceAll("题目","").replaceAll("###",""),console.log(r[1]),poc.innerHTML+=`\n<br><br>\n<div class="alert alert-info" role="alert" id="solution" style="display: none;">\n  <h5 class="alert-heading">题解</h4>\n  <hr>\n  <p>${window.md.render(r[1].replaceAll("_","\\_").replaceAll("(","\\(").replaceAll(")","\\)").replaceAll("]","\\]").replaceAll("[","\\["))}</p>\n</div>`,spck.innerHTML+='\n<button \n    class="btn btn-secondary btn-sm dropdown-toggle" \n    type="button" \n    data-bs-toggle="dropdown" \n    aria-expanded="false"\n    >查看知识点...\n</button>&nbsp;\n<button class="btn btn-sm btn-primary" onclick="togSolution();">\n    题解\n</button>',window.MathJax.typesetPromise(),uic.innerHTML="<h6>...出题完毕!</h6>"}}function e(){console.log("loaded..."),uic=document.getElementById("uic"),spck=document.getElementById("probcontent"),poc=document.getElementById("poc");var e=document.getElementById("klkk");if(null==localStorage.getItem(DBNAME)&&localStorage.setItem(DBNAME,"{}"),null==localStorage.getItem(DCNAME)&&localStorage.setItem(DCNAME,"{}"),null==localStorage.getItem(DBNAME)&&null==localStorage.getItem(DCNAME))e.innerHTML="暂无知识点, 快去上传题目吧!";else if("{}"==localStorage.getItem(DBNAME)&&"{}"==localStorage.getItem(DCNAME))e.innerHTML="暂无知识点, 快去上传题目吧!";else{const r=JSON.parse(localStorage.getItem(DBNAME)),c=JSON.parse(localStorage.getItem(DCNAME));var t=new Set,n="\n<table class='table'>\n    <tr>\n        <th class='lcol'>&nbsp;&nbsp;知识点</th>\n        <th>正确率</th>\n        <th>√</th>\n        <th>x</th>\n    </tr>";for(var l in r)t.add(l),r[l];for(var l in c)t.add(l),c[l];for(let e of t){var a=readK(e),o=readC(e);n+=-1==a?`<tr><td class="lcol"><input name="copt" type="checkbox" value="${e}">&nbsp;${e}</input></td><td>0%</td><td>0</td><td>${o}</td></tr>`:-1==o?`<tr><td class="lcol"><input name="copt" type="checkbox" value="${e}">&nbsp;${e}</input></td><td>100%</td><td>${a}</td><td>0</td></tr>`:`<tr><td class="lcol"><input name="copt" type="checkbox" value="${e}">&nbsp;${e}</input></td><td>${Math.round(1e3*a/(a+o))/10}%</td><td>${a}</td><td>${o}</td></tr>`}n+="</table>",e.innerHTML=n}}function resetData(){1==confirm("确定清空数据?")&&(localStorage.setItem("hmscannerdat","{}"),e(),console.log("Cleared"))}const tok="pat_lxlFBra1XGfDvbGLbELzhbE9C1OcSyBZolRQL7Yn4DpXTuZQKwF4tAapB7RoR7h3",DBNAME="hmscannerdat",DCNAME="hmscannerdax";var spck=null,uic=null,poc=null,MathJax=null;document.addEventListener("DOMContentLoaded",e);